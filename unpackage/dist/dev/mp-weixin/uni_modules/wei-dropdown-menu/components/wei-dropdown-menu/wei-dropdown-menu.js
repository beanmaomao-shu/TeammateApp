"use strict";const n=require("../../../../common/vendor.js"),E=require("./props.js"),j={emits:["change"],props:E.dropdownMenuProps,setup(e,{emit:T,expose:w}){const r=n.getCurrentInstance();let I={};const i=n.reactive({activeIndex:-1,activeOptions:{},activeTreeIndex:-1,currentOptions:[],popupContentShow:!1,treeContentHeight:0,popupTop:0});let o=null,t=!1;n.onMounted(()=>{o=n.index.createSelectorQuery().in(r),I=n.index.getWindowInfo(),setTimeout(()=>{o.select(".wei-dropdown-menu").boundingClientRect(a=>{a&&(i.popupTop=a.height+a.top+I.windowTop)}).exec()},100)}),n.watch(()=>e.value,(a,u)=>{a&&a instanceof Object&&Object.keys(a).forEach(l=>{const d=e.data.findIndex(v=>v.name===l),p=e.data[d]?e.data[d].options:null;if(d>-1&&p)if(Array.isArray(a[l])){if(a[l].length!==2){console.warn("二级分类的value值格式有误，请检查!!!");return}const v=p.findIndex(c=>c.value===a[l][0]);if(v>-1){const c=p[v].children.findIndex(h=>h.value===a[l][1]);c>-1&&(i.activeOptions[d]=[p[v].children[c],c,v])}}else{const v=p.findIndex(c=>c.value===a[l]);v>-1&&(i.activeOptions[d]=[p[v],v])}})},{immediate:!0}),n.watch(()=>e.data,()=>{i.activeOptions={},i.activeIndex=-1,i.activeTreeIndex=-1});const f=n.ref("hide"),s=n.ref("hide"),O=n.ref("hide"),m=n.computed(()=>e.data);function g(a,u){if(!t){if(t=!0,i.activeIndex>-1){C();return}i.currentOptions=m.value[u].options||[],i.activeIndex=u,m.value[u].treeSelect&&i.activeOptions[u]&&(i.activeTreeIndex=i.activeOptions[u][2]),n.nextTick$1(()=>{b()})}}function b(){f.value="show",s.value="fade-in",O.value="slide-down",n.nextTick$1(()=>{setTimeout(()=>{O.value="show",s.value="show",S(),t=!1},e.duration*1e3)})}function C(){O.value="slide-up",s.value="fade-out",setTimeout(()=>{f.value="hide",O.value="hide",s.value="hide",i.activeIndex=-1,i.currentOptions=[],i.activeTreeIndex=-1,t=!1},e.duration*1e3)}function k(a,u,l=null){i.activeOptions[i.activeIndex]=[a,u,l];const d={};Object.keys(i.activeOptions).forEach(p=>{if(i.activeOptions[p]){const v=n.unref(i.activeOptions[p]),c=e.data[p].name;if(v[2]){const h=e.data[p].options[v[2]].value;d[c]=[h,v[0].value]}else d[c]=v[0].value}}),T("change",{item:n.unref(a),value:d}),C()}function P(){}function M(){e.closeOnClickOverlay&&C()}function y(a,u){i.activeOptions[i.activeIndex]=[a,u,n.unref(i.activeTreeIndex)]}function H(a,u){i.activeTreeIndex=u}function S(){o.select(".wei-dropdown-menu-popup-content").boundingClientRect(a=>{i.treeContentHeight=a.height}).exec()}return{...n.toRefs(i),menuPopupClass:f,menuPopupContentClass:O,menuPopupMaskClass:s,menuData:m,onOptionClick:k,onMenuClick:g,onTreeParent:H,onTreeOptionClick:y,onOverlayClick:M,onEmptyClick:P}}};function q(e,T,w,r,I,i){return n.e({a:n.f(r.menuData,(o,t,f)=>({a:n.t(e.activeOptions[t]?e.activeOptions[t][0].label:o.title),b:t,c:n.o(s=>r.onMenuClick(o,t),t),d:n.n(e.activeIndex===t&&r.menuPopupMaskClass!=="fade-out"?"active":""),e:o.menuWidth?o.menuWidth:"auto"})),b:n.s(e.menuItemStyle),c:e.overlay},e.overlay?{d:n.n("wei-dropdown-menu-popup-mask--"+r.menuPopupMaskClass),e:n.o((...o)=>r.onOverlayClick&&r.onOverlayClick(...o))}:{},{f:e.activeIndex>-1&&e.data[e.activeIndex].treeSelect===!0},e.activeIndex>-1&&e.data[e.activeIndex].treeSelect===!0?n.e({g:n.f(e.currentOptions,(o,t,f)=>({a:n.t(o.label),b:t,c:n.n(e.activeTreeIndex===t?"active":""),d:n.o(s=>r.onTreeParent(o,t),t)})),h:e.activeTreeIndex>-1&&e.currentOptions[e.activeTreeIndex].children},e.activeTreeIndex>-1&&e.currentOptions[e.activeTreeIndex].children?{i:n.f(e.currentOptions[e.activeTreeIndex].children,(o,t,f)=>n.e({a:n.t(o.label),b:e.activeOptions[e.activeIndex]&&e.activeOptions[e.activeIndex][2]===e.activeTreeIndex&&e.activeOptions[e.activeIndex][1]===t},e.activeOptions[e.activeIndex]&&e.activeOptions[e.activeIndex][2]===e.activeTreeIndex&&e.activeOptions[e.activeIndex][1]===t?{c:e.activeColor}:{},{d:o.tip},o.tip?{e:n.t(o.tip)}:{},{f:t,g:n.o(s=>r.onOptionClick(o,t,e.activeTreeIndex),t),h:n.n(e.activeOptions[e.activeIndex]&&e.activeOptions[e.activeIndex][2]===e.activeTreeIndex&&e.activeOptions[e.activeIndex][1]===t?"active":"")}))}:{},{j:e.treeContentHeight+"px",k:e.data[e.activeIndex].popupHeight?e.data[e.activeIndex].popupHeight:"auto"}):{l:n.f(e.currentOptions,(o,t,f)=>n.e({a:n.t(o.label),b:e.activeOptions[e.activeIndex]&&e.activeOptions[e.activeIndex][1]===t},e.activeOptions[e.activeIndex]&&e.activeOptions[e.activeIndex][1]===t?{c:e.activeColor}:{},{d:t,e:n.o(s=>r.onOptionClick(o,t,null),t),f:n.n(e.activeOptions[e.activeIndex]&&e.activeOptions[e.activeIndex][1]===t?"active":"")}))},{m:n.n("wei-dropdown-menu-popup-content--"+r.menuPopupContentClass),n:n.o((...o)=>r.onEmptyClick&&r.onEmptyClick(...o)),o:n.n("wei-dropdown-menu-popup--"+r.menuPopupClass),p:e.popupTop+"px",q:e.activeColor,r:e.duration+"s"})}const D=n._export_sfc(j,[["render",q],["__scopeId","data-v-988ec59d"]]);wx.createComponent(D);
