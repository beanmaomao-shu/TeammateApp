"use strict";const d=require("../uni-data-pickerview/uni-data-picker.js"),i=require("../../../../common/vendor.js"),c=()=>"../uni-data-pickerview/uni-data-pickerview.js",h={name:"UniDataPicker",emits:["popupopened","popupclosed","nodeclick","input","change","update:modelValue","inputclick"],mixins:[d.dataPicker],components:{DataPickerView:c},props:{options:{type:[Object,Array],default(){return{}}},popupTitle:{type:String,default:"请选择"},placeholder:{type:String,default:"请选择"},heightMobile:{type:String,default:""},readonly:{type:Boolean,default:!1},clearIcon:{type:Boolean,default:!0},border:{type:Boolean,default:!0},split:{type:String,default:"/"},ellipsis:{type:Boolean,default:!0}},data(){return{isOpened:!1,inputSelected:[]}},created(){this.$nextTick(()=>{this.load()})},watch:{localdata:{handler(){this.load()},deep:!0}},methods:{clear(){this._dispatchEvent([])},onPropsChange(){this._treeData=[],this.selectedIndex=0,this.load()},load(){if(this.readonly){this._processReadonly(this.localdata,this.dataValue);return}this.isLocalData?(this.loadData(),this.inputSelected=this.selected.slice(0)):(this.isCloudDataList||this.isCloudDataTree)&&(this.loading=!0,this.getCloudDataValue().then(e=>{this.loading=!1,this.inputSelected=e}).catch(e=>{this.loading=!1,this.errorMessage=e}))},show(){this.isOpened=!0,setTimeout(()=>{this.$refs.pickerView.updateData({treeData:this._treeData,selected:this.selected,selectedIndex:this.selectedIndex})},200),this.$emit("popupopened")},hide(){this.isOpened=!1,this.$emit("popupclosed")},handleInput(){if(this.readonly){this.$emit("inputclick");return}this.show()},handleClose(e){this.hide()},onnodeclick(e){this.$emit("nodeclick",e)},ondatachange(e){this._treeData=this.$refs.pickerView._treeData},onchange(e){this.hide(),this.$nextTick(()=>{this.inputSelected=e}),this._dispatchEvent(e)},_processReadonly(e,a){var n=e.findIndex(t=>t.children);if(n>-1){let t;Array.isArray(a)?(t=a[a.length-1],typeof t=="object"&&t.value&&(t=t.value)):t=a,this.inputSelected=this._findNodePath(t,this.localdata);return}if(!this.hasValue){this.inputSelected=[];return}let o=[];for(let t=0;t<a.length;t++){var l=a[t],r=e.find(s=>s.value==l);r&&o.push(r)}o.length&&(this.inputSelected=o)},_filterForArray(e,a){var n=[];for(let r=0;r<a.length;r++){var o=a[r],l=e.find(t=>t.value==o);l&&n.push(l)}return n},_dispatchEvent(e){let a={};if(e.length){for(var n=new Array(e.length),o=0;o<e.length;o++)n[o]=e[o].value;a=e[e.length-1]}else a.value="";this.formItem&&this.formItem.setValue(a.value),this.$emit("input",a.value),this.$emit("update:modelValue",a.value),this.$emit("change",{detail:{value:e}})}}};if(!Array){const e=i.resolveComponent("uni-load-more"),a=i.resolveComponent("uni-icons"),n=i.resolveComponent("data-picker-view");(e+a+n)()}const u=()=>"../../../uni-load-more/components/uni-load-more/uni-load-more.js",p=()=>"../../../uni-icons/components/uni-icons/uni-icons.js";Math||(u+p)();function f(e,a,n,o,l,r){return i.e({a:e.errorMessage},e.errorMessage?{b:i.t(e.errorMessage)}:e.loading&&!l.isOpened?{d:i.p({contentText:e.loadMore,status:"loading"})}:l.inputSelected.length?{f:i.f(l.inputSelected,(t,s,g)=>i.e({a:i.t(t.text),b:s<l.inputSelected.length-1},s<l.inputSelected.length-1?{c:i.t(n.split)}:{},{d:s}))}:{g:i.t(n.placeholder)},{c:e.loading&&!l.isOpened,e:l.inputSelected.length,h:n.clearIcon&&!n.readonly&&l.inputSelected.length},n.clearIcon&&!n.readonly&&l.inputSelected.length?{i:i.p({type:"clear",color:"#c0c4cc",size:"24"}),j:i.o((...t)=>r.clear&&r.clear(...t))}:{},{k:(!n.clearIcon||!l.inputSelected.length)&&!n.readonly},(!n.clearIcon||!l.inputSelected.length)&&!n.readonly?{}:{},{l:n.border?1:"",m:i.r("d",{options:n.options,data:l.inputSelected,error:e.errorMessage}),n:i.o((...t)=>r.handleInput&&r.handleInput(...t)),o:l.isOpened},l.isOpened?{p:i.o((...t)=>r.handleClose&&r.handleClose(...t))}:{},{q:l.isOpened},l.isOpened?{r:i.t(n.popupTitle),s:i.o((...t)=>r.handleClose&&r.handleClose(...t)),t:i.sr("pickerView","8268493a-2"),v:i.o(r.onchange),w:i.o(r.ondatachange),x:i.o(r.onnodeclick),y:i.o(t=>e.dataValue=t),z:i.p({localdata:e.localdata,preload:e.preload,collection:e.collection,field:e.field,orderby:e.orderby,where:e.where,"step-searh":e.stepSearh,"self-field":e.selfField,"parent-field":e.parentField,"managed-mode":!0,map:e.map,ellipsis:n.ellipsis,modelValue:e.dataValue})}:{})}const m=i._export_sfc(h,[["render",f]]);wx.createComponent(m);
