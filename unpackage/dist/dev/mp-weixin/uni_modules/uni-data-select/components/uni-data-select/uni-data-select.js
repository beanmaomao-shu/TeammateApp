"use strict";const i=require("../../../../common/vendor.js"),r={name:"uni-data-select",mixins:[i.Vs.mixinDatacom||{}],props:{localdata:{type:Array,default(){return[]}},value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:"请选择"},emptyTips:{type:String,default:"无选项"},clear:{type:Boolean,default:!0},defItem:{type:Number,default:0},disabled:{type:Boolean,default:!1},format:{type:String,default:""},placement:{type:String,default:"bottom"}},data(){return{showSelector:!1,current:"",mixinDatacomResData:[],apps:[],channels:[],cacheKey:"uni-data-select-lastSelectedValue"}},created(){this.debounceGet=this.debounce(()=>{this.query()},300),this.collection&&!this.localdata.length&&this.debounceGet()},computed:{typePlaceholder(){const e={"opendb-stat-app-versions":"版本","opendb-app-channels":"渠道","opendb-app-list":"应用"},a=this.placeholder,t=e[this.collection];return t?a+t:a},valueCom(){return this.modelValue},textShow(){let e=this.current;return e.length>10?e.slice(0,25)+"...":e},getOffsetByPlacement(){switch(this.placement){case"top":return"bottom:calc(100% + 12px);";case"bottom":return"top:calc(100% + 12px);"}}},watch:{localdata:{immediate:!0,handler(e,a){Array.isArray(e)&&a!==e&&(this.mixinDatacomResData=e)}},valueCom(e,a){this.initDefVal()},mixinDatacomResData:{immediate:!0,handler(e){e.length&&this.initDefVal()}}},methods:{debounce(e,a=100){let t=null;return function(...n){t&&clearTimeout(t),t=setTimeout(()=>{e.apply(this,n)},a)}},query(){this.mixinDatacomEasyGet()},onMixinDatacomPropsChange(){this.collection&&this.debounceGet()},initDefVal(){let e="";if((this.valueCom||this.valueCom===0)&&!this.isDisabled(this.valueCom))e=this.valueCom;else{let t;if(this.collection&&(t=this.getCache()),t||t===0)e=t;else{let n="";this.defItem>0&&this.defItem<=this.mixinDatacomResData.length&&(n=this.mixinDatacomResData[this.defItem-1].value),e=n}(e||e===0)&&this.emit(e)}const a=this.mixinDatacomResData.find(t=>t.value===e);this.current=a?this.formatItemName(a):""},isDisabled(e){let a=!1;return this.mixinDatacomResData.forEach(t=>{t.value===e&&(a=t.disable)}),a},clearVal(){this.emit(""),this.collection&&this.removeCache()},change(e){e.disable||(this.showSelector=!1,this.current=this.formatItemName(e),this.emit(e.value))},emit(e){this.$emit("input",e),this.$emit("update:modelValue",e),this.$emit("change",e),this.collection&&this.setCache(e)},toggleSelector(){this.disabled||(this.showSelector=!this.showSelector)},formatItemName(e){let{text:a,value:t,channel_code:n}=e;if(n=n?`(${n})`:"",this.format){let c="";c=this.format;for(let l in e)c=c.replace(new RegExp(`{${l}}`,"g"),e[l]);return c}else return this.collection.indexOf("app-list")>0?`${a}(${t})`:a||`未命名${n}`},getLoadData(){return this.mixinDatacomResData},getCurrentCacheKey(){return this.collection},getCache(e=this.getCurrentCacheKey()){return(i.index.getStorageSync(this.cacheKey)||{})[e]},setCache(e,a=this.getCurrentCacheKey()){let t=i.index.getStorageSync(this.cacheKey)||{};t[a]=e,i.index.setStorageSync(this.cacheKey,t)},removeCache(e=this.getCurrentCacheKey()){let a=i.index.getStorageSync(this.cacheKey)||{};delete a[e],i.index.setStorageSync(this.cacheKey,a)}}};Array||i.resolveComponent("uni-icons")();const h=()=>"../../../uni-icons/components/uni-icons/uni-icons.js";Math||h();function m(e,a,t,n,c,l){return i.e({a:t.label},t.label?{b:i.t(t.label+"：")}:{},{c:c.current},c.current?{d:i.t(l.textShow)}:{e:i.t(l.typePlaceholder)},{f:c.current&&t.clear&&!t.disabled},c.current&&t.clear&&!t.disabled?{g:i.p({type:"clear",color:"#c0c4cc",size:"24"}),h:i.o((...o)=>l.clearVal&&l.clearVal(...o))}:{i:i.p({type:c.showSelector?"top":"bottom",size:"14",color:"#999"})},{j:i.o((...o)=>l.toggleSelector&&l.toggleSelector(...o)),k:c.showSelector},c.showSelector?{l:i.o((...o)=>l.toggleSelector&&l.toggleSelector(...o))}:{},{m:c.showSelector},c.showSelector?i.e({n:i.n(t.placement=="bottom"?"uni-popper__arrow_bottom":"uni-popper__arrow_top"),o:c.mixinDatacomResData.length===0},c.mixinDatacomResData.length===0?{p:i.t(t.emptyTips)}:{q:i.f(c.mixinDatacomResData,(o,s,d)=>({a:i.t(l.formatItemName(o)),b:o.disable?1:"",c:s,d:i.o(f=>l.change(o),s)}))},{r:i.s(l.getOffsetByPlacement)}):{},{s:t.disabled?1:"",t:c.current?1:""})}const u=i._export_sfc(r,[["render",m]]);wx.createComponent(u);
