"use strict";const n=require("../common/vendor.js"),a=require("../utils/request.js"),d=t=>a.request({url:`/ws/${t}`,method:"GET"}),l=t=>a.request({url:"/ws/unread",method:"GET",params:{chatRoomIds:t}}),i=t=>a.request({url:`/ws/markRead/${t}`,method:"PUT"}),c=t=>new Promise((u,o)=>{const r=n.index.getStorageSync("token");console.log("上传图片使用的token:",r),n.index.uploadFile({url:"http://117.72.54.182:8898/users/upload",filePath:t,name:"file",header:{Authorization:r},formData:{},success:e=>{console.log("上传响应状态码:",e.statusCode),console.log("上传响应数据:",e.data);try{if(e.statusCode!==200){o(new Error(`上传失败，状态码: ${e.statusCode}`));return}if(!e.data){o(new Error("服务器返回数据为空"));return}const s=JSON.parse(e.data);u(s)}catch(s){o(s)}},fail:e=>{console.error("上传请求失败:",e),o(e)}})});exports.getChatMessages=d;exports.getUnreadCount=l;exports.markMessagesAsRead=i;exports.uploadFile=c;
