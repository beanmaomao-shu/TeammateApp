"use strict";const e=require("../../common/vendor.js"),w=require("../../api/team.js"),F=require("../../api/contest.js");if(!Array){const p=e.resolveComponent("uni-badge"),c=e.resolveComponent("uni-data-select"),l=e.resolveComponent("uni-file-picker"),t=e.resolveComponent("uni-datetime-picker"),u=e.resolveComponent("uni-icons"),r=e.resolveComponent("uni-data-picker"),m=e.resolveComponent("fcButton");(p+c+l+t+u+r+m)()}const C=()=>"../../uni_modules/uni-badge/components/uni-badge/uni-badge.js",L=()=>"../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js",I=()=>"../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js",B=()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js",E=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",j=()=>"../../uni_modules/uni-data-picker/components/uni-data-picker/uni-data-picker.js",P=()=>"../../components/fcButton/fcButton.js";Math||(C+L+I+B+E+j+P)();const D={__name:"makeTeam",setup(p){const c=e.ref({width:90,height:90,border:{color:"#68c984",width:1,style:"dashed",radius:"10rpx"}}),l=e.ref([{value:"1",name:"专科"},{value:"2",name:"普通本科"},{value:"3",name:"92高校"},{value:"4",name:"研究生"}]),t=e.ref({name:"",icon:"",slogan:"",introduction:"",numbers:0,matchId:1,endTime:"",matchLocation:""});e.ref();const u=e.ref([{text:"0",value:0},{text:"1",value:1},{text:"2",value:2},{text:"3",value:3},{text:"4",value:4},{text:"5",value:5},{text:"6",value:6},{text:"7",value:7},{text:"8",value:8},{text:"9",value:9},{text:"10",value:10}]),r=o=>{const a=parseInt(o.value||o);t.value.numbers=a,console.log("选择的人数：",t.value.numbers)},m=o=>{t.value.endTime=o,console.log("选择的截止时间：",t.value.endTime)},f=o=>{console.log("文件选择事件：",o),v(o)},h=o=>{console.log("上传进度：",o)},x=o=>{console.error("上传失败：",o)},v=async o=>{try{if(console.log("文件上传事件触发：",o),!o.tempFiles||!o.tempFiles.length){console.error("没有获取到文件信息");return}const a=o.tempFiles[0].url||o.tempFiles[0].path,n=e.index.getStorageSync("token");e.index.uploadFile({url:"http://117.72.54.182:8898/users/upload",filePath:a,name:"file",header:{Authorization:n},success:s=>{try{console.log("上传响应：",s);const i=JSON.parse(s.data);if(i.code===200)t.value.icon=i.data.url,console.log("设置图片URL：",t.value.icon),e.index.showToast({title:"图片上传成功",icon:"success"});else throw new Error("上传失败: "+i.message)}catch(i){console.error("解析上传响应失败：",i)}},fail:s=>{console.error("图片上传失败：",s),e.index.showToast({title:"图片上传失败",icon:"error"})}})}catch(a){console.error("图片上传异常：",a)}},y=async()=>{if(console.log("发布组队函数被调用"),!t.value.icon){e.index.showToast({title:"请上传队伍图标",icon:"none"});return}if(!t.value.name){e.index.showToast({title:"请填写队伍名称",icon:"none"});return}if(!t.value.slogan){e.index.showToast({title:"请填写队伍口号",icon:"none"});return}if(!t.value.introduction){e.index.showToast({title:"请填写队伍简介",icon:"none"});return}if(!t.value.endTime){e.index.showToast({title:"请选择截止时间",icon:"none"});return}if(!t.value.matchLocation){e.index.showToast({title:"请选择比赛地点",icon:"none"});return}try{const o={name:String(t.value.name||""),icon:String(t.value.icon||""),slogan:String(t.value.slogan||""),introduction:String(t.value.introduction||""),numbers:parseInt(t.value.numbers)||0,endTime:String(t.value.endTime||""),matchLocation:String(t.value.matchLocation||""),matchId:parseInt(t.value.matchId)||1};console.log("发送的格式化数据：",JSON.stringify(o,null,2)),(await w.createTeamAPI(o)).code===200?(e.index.showToast({title:"发布成功",icon:"success"}),e.index.switchTab({url:"/pages/teammateHall/teammateHall"})):e.index.showToast({title:"发布失败，请重试",icon:"error"})}catch(o){console.error("创建队伍失败：",o),o.response&&console.error("错误响应数据：",o.response.data),e.index.showToast({title:"创建失败",icon:"error"})}},_=e.ref([]),k=async()=>{try{const o=await F.getContest();o.data&&(_.value=o.data.map(a=>({value:a.id,text:a.name})))}catch(o){console.error("获取比赛列表失败：",o),e.index.showToast({title:"获取比赛列表失败",icon:"none"})}},g=e.ref(""),T=o=>{t.value.matchId=parseInt(o),console.log("选择的比赛ID：",t.value.matchId)};e.onMounted(()=>{k()});const d=e.ref("定位您的位置"),b=()=>{e.index.chooseLocation({success:o=>{d.value=o.name,t.value.matchLocation=o.name,console.log("选择的地点：",t.value.matchLocation)},fail:()=>{e.index.getSetting({success:o=>{o.authSetting["scope.userLocation"]||e.index.showModal({title:"是否授权当前位置",content:"需要获取您的地理位置，请确认授权",success:a=>{a.confirm&&e.index.openSetting({success:n=>{n.authSetting["scope.userLocation"]===!0&&(e.index.showToast({title:"授权成功",icon:"success"}),e.index.chooseLocation({success:s=>{d.value=s.name,t.value.matchLocation=s.name}}))}})}})}})}})},S=o=>{console.log("选择的组别：",o.detail.value)};return(o,a)=>({a:e.p({text:"+",type:"primary"}),b:e.o(T),c:e.o(n=>g.value=n),d:e.p({localdata:_.value,modelValue:g.value}),e:e.p({text:"1",customStyle:{background:"#8707ff"}}),f:e.o(f),g:e.o(v),h:e.o(h),i:e.o(x),j:e.p({limit:"1",title:"",fileMediatype:"image","image-styles":c.value,action:"http://117.72.54.182:8898/users/upload"}),k:e.p({text:"2",customStyle:{background:"#8707ff"}}),l:t.value.name,m:e.o(n=>t.value.name=n.detail.value),n:e.p({text:"3",customStyle:{background:"#8707ff"}}),o:t.value.slogan,p:e.o(n=>t.value.slogan=n.detail.value),q:e.p({text:"4",type:"primary",customStyle:{background:"#8707ff"}}),r:e.f(l.value,(n,s,i)=>({a:n.value,b:s===o.current,c:e.t(n.name),d:n.value})),s:e.o(S),t:e.p({text:"5",customStyle:{background:"#8707ff"}}),v:t.value.introduction,w:e.o(n=>t.value.introduction=n.detail.value),x:e.p({text:"6",customStyle:{background:"#8707ff"}}),y:e.o(m),z:e.p({type:"date",value:t.value.endTime}),A:e.p({type:"map-pin-ellipse",size:"20"}),B:e.t(d.value),C:e.o(b),D:e.o(r),E:e.o(n=>t.value.numbers=n),F:e.p({localdata:u.value,"popup-title":"请选择组队人数",modelValue:t.value.numbers}),G:e.p({"img-src":"/static/images/发布.png",Title:"发布组队",Color:"#6B57FE"}),H:e.o(y)})}},M=e._export_sfc(D,[["__scopeId","data-v-f62f500a"]]);wx.createPage(M);
