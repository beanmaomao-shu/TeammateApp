"use strict";const e=require("../../common/vendor.js"),v=require("../../common/assets.js"),g=require("../../api/ai.js");if(!Array){const m=e.resolveComponent("uni-icons"),r=e.resolveComponent("transition");(m+r)()}const w=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js";Math||w();const T={__name:"ai",setup(m){const r=e.ref(0),s=e.ref([{type:1,text:"你好！我是Teammate的AI助手。",time:"9:32"},{type:1,text:"有比赛相关的什么问题请尽管问",time:"9:32",loading:!1},{type:2,text:"Hi！我想问的是.....",time:"9:33"}]),n=e.ref(""),i=e.ref(!1),_=()=>{i.value=!i.value,i.value&&setTimeout(()=>{h()},300)},h=()=>{e.index.nextTick(()=>{setTimeout(()=>{const o=e.index.createSelectorQuery();o.select("#chatScroll").boundingClientRect(),o.select("#chatScroll").scrollOffset(),o.exec(a=>{a[1]&&(r.value=a[1].scrollTop+a[0].height+50)})},100)})},d=async()=>{const o=n.value;if(n.value="",o.trim()){const a=new Date().toLocaleTimeString("zh-CN",{hour12:!1}).slice(0,5);s.value.push({type:2,text:o,time:a,isImage:!1}),s.value.push({type:1,text:"思考中...",time:a,loading:!0});try{const l=(await g.zhipuChat(o)).id;let p=0;const f=20;let u=null;for(;p<f;){await new Promise(y=>setTimeout(y,2e3));const c=await g.zhipuResult(l);if(console.log("智谱回复aiRes",c),c.task_status==="SUCCESS"){u=c;break}if(c.task_status==="FAILED")break;p++}s.value=s.value.filter(c=>!c.loading),u&&u.choices&&u.choices.length>0?s.value.push({type:1,text:u.choices[0].message.content,time:new Date().toLocaleTimeString("zh-CN",{hour12:!1}).slice(0,5),loading:!1}):s.value.push({type:1,text:"抱歉，AI暂时没有返回结果，请稍后再试。",time:new Date().toLocaleTimeString("zh-CN",{hour12:!1}).slice(0,5),loading:!1})}catch{s.value=s.value.filter(l=>!l.loading),s.value.push({type:1,text:"抱歉，AI请求出错，请稍后再试。",time:new Date().toLocaleTimeString("zh-CN",{hour12:!1}).slice(0,5),loading:!1})}}h()};return(o,a)=>({a:e.f(s.value,(t,l,p)=>e.e({a:t.type==1},t.type==1?{b:v._imports_0$8,c:e.t(t.text),d:e.t(t.time)}:{},{e:t.type==2},t.type==2?e.e({f:!t.isImage},t.isImage?{h:t.text,i:e.o(f=>o.previewImage(t.text),l)}:{g:e.t(t.text)},{j:e.t(t.time),k:v._imports_1$2}):{},{l})),b:i.value?1:"",c:r.value,d:e.o((...t)=>o.onScrollToLower&&o.onScrollToLower(...t)),e:e.o([t=>n.value=t.detail.value,(...t)=>o.handleInput&&o.handleInput(...t)]),f:n.value,g:e.o(_),h:!n.value,i:e.p({type:"plus",size:"40"}),j:n.value,k:e.o(d),l:e.p({type:"email",size:"40"}),m:i.value,n:e.p({name:"slide-up"}),o:i.value?1:""})}},x=e._export_sfc(T,[["__scopeId","data-v-fdb58938"]]);wx.createPage(x);
