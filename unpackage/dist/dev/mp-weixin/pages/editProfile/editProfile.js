"use strict";const a=require("../../common/vendor.js"),w=require("../../common/assets.js"),l=require("../../api/userInfo.js");Array||a.resolveComponent("uni-icons")();const _=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js";Math||_();const f={__name:"editProfile",setup(c){const r=["请选择性别","男","女"],e=a.ref({username:"",sex:"",school:"",phone:"",wechatId:"",email:"",introduction:"",location:"",awards:[]}),u=async()=>{try{const o=await l.getUserInfoAPI();if(o.data){let s=[];try{s=o.data.awards?JSON.parse(o.data.awards):[]}catch(t){console.error("解析 awards 失败：",t),s=[]}e.value={username:o.data.username||"",sex:o.data.sex==="男"?1:o.data.sex==="女"?2:0,school:o.data.school||"",phone:o.data.phone||"",wechatId:o.data.wechatId||"",email:o.data.email||"",introduction:o.data.introduction||"",location:o.data.location||"",awards:s.map(t=>({name:t}))}}console.log("获取到的用户信息：",e.value)}catch(o){console.error("获取用户信息失败：",o)}},d=async()=>{try{if(!e.value.username.trim()){a.index.showToast({title:"请输入昵称",icon:"none"});return}const o=e.value.awards.map(n=>n.name).filter(n=>n.trim()),s={username:String(e.value.username||""),sex:String(r[e.value.sex]||""),school:String(e.value.school||""),phone:String(e.value.phone||""),wechatId:String(e.value.wechatId||""),email:String(e.value.email||""),awards:JSON.stringify(o),location:String(e.value.location||""),introduction:String(e.value.introduction||"")};console.log("准备提交的数据：",s);const t=await l.editUserInfoAPI(s);if(t.code===200)a.index.showToast({title:"保存成功",icon:"success"}),setTimeout(()=>{a.index.navigateBack()},1500);else throw new Error(t.message||"保存失败")}catch(o){console.error("保存失败：",o),a.index.showToast({title:o.message||"保存失败，请重试",icon:"none"})}},v=o=>{e.value.sex=parseInt(o.detail.value)},m=()=>{e.value.awards.push({name:""})},h=o=>{e.value.awards.splice(o,1)};return a.onMounted(()=>{u()}),(o,s)=>({a:w._imports_0$1,b:a.p({type:"camera-filled",size:"20",color:"#fff"}),c:e.value.username,d:a.o(t=>e.value.username=t.detail.value),e:a.t(r[e.value.sex]),f:a.o(v),g:e.value.sex,h:r,i:e.value.school,j:a.o(t=>e.value.school=t.detail.value),k:e.value.location,l:a.o(t=>e.value.location=t.detail.value),m:e.value.phone,n:a.o(t=>e.value.phone=t.detail.value),o:e.value.wechatId,p:a.o(t=>e.value.wechatId=t.detail.value),q:e.value.email,r:a.o(t=>e.value.email=t.detail.value),s:a.f(e.value.awards,(t,n,p)=>({a:t.name,b:a.o(i=>t.name=i.detail.value,n),c:a.o(i=>h(n),n),d:"8a448ed0-1-"+p,e:n})),t:a.p({type:"trash",size:"20",color:"#999"}),v:a.p({type:"plus",size:"20",color:"#7700ff"}),w:a.o(m),x:e.value.introduction,y:a.o(t=>e.value.introduction=t.detail.value),z:a.t(e.value.introduction.length),A:a.o(d)})}},g=a._export_sfc(f,[["__scopeId","data-v-8a448ed0"]]);wx.createPage(g);
